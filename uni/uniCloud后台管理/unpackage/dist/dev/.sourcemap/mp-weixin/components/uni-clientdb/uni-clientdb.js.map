{"version":3,"sources":["webpack:///E:/vue/uni/uniCloud后台管理/components/uni-clientdb/uni-clientdb.vue?c2b9","webpack:///E:/vue/uni/uniCloud后台管理/components/uni-clientdb/uni-clientdb.vue?01a9","webpack:///E:/vue/uni/uniCloud后台管理/components/uni-clientdb/uni-clientdb.vue?de64","webpack:///E:/vue/uni/uniCloud后台管理/components/uni-clientdb/uni-clientdb.vue?fa06","uni-app:///components/uni-clientdb/uni-clientdb.vue"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyH;AACzH;AACgE;AACL;;;AAG3D;AACoM;AACpM,gBAAgB,6MAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,uFAAM;AACR,EAAE,gGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAiwB,CAAgB,sxBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACOrxB;AACA;;AAEA;AACA,cADA;AAEA,gBAFA;;AAIA;AACA,YADA;AAEA,oBAFA;;;AAKA;AACA,aADA;AAEA,UAFA;AAGA,YAHA;AAIA,QAJA;AAKA,OALA;AAMA,UANA;AAOA,SAPA;AAQA,OARA;;;AAWA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA,qBADA;AAEA;AACA;AACA,2BADA;AAEA,aAFA,sBAEA;AACA;AACA,OAJA,EADA;;AAOA;AACA,kBADA;AAEA,iBAFA,EAPA;;AAWA;AACA,kBADA;AAEA,iBAFA,EAXA;;AAeA;AACA,kBADA;AAEA,iBAFA,EAfA;;AAmBA;AACA,kBADA;AAEA,oBAFA,EAnBA;;AAuBA;AACA,kBADA;AAEA,gBAFA,EAvBA;;AA2BA;AACA,kBADA;AAEA,iBAFA,EA3BA;;AA+BA;AACA,6BADA;AAEA,oBAFA,EA/BA;;AAmCA;AACA,kBADA;AAEA,iBAFA,EAnCA;;AAuCA;AACA,4BADA;AAEA,iBAFA,EAvCA;;AA2CA;AACA,6BADA;AAEA,oBAFA,EA3CA;;AA+CA;AACA,mBADA;AAEA,oBAFA,EA/CA,EAFA;;;AAsDA,MAtDA,kBAsDA;AACA;AACA,oBADA;AAEA,qCAFA;AAGA;AACA,iCADA;AAEA,2BAFA;AAGA,gBAHA,EAHA;;AAQA,sBARA;;AAUA,GAjEA;AAkEA,SAlEA,qBAkEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA,KANA,EAMA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAzBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;AACA,GA3IA;;;;;;;;;;;;;;;AA0JA;AACA,YADA,oBACA,KADA,EACA,KADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAXA,MAWA;AACA;AACA;;AAEA;AACA,KAnBA;AAoBA,YApBA,sBAoBA;AACA;AACA;AACA;AACA;AACA,KAzBA;AA0BA,WA1BA,qBA0BA;AACA;AACA;AACA,KA7BA;AA8BA,SA9BA,mBA8BA;AACA;AACA;AACA,KAjCA;AAkCA,SAlCA,mBAkCA;AACA;AACA,KApCA;AAqCA,UArCA,kBAqCA,EArCA;;;;;AA0CA,yGAJA,MAIA,QAJA,MAIA,CAHA,QAGA,QAHA,QAGA,CAFA,YAEA,QAFA,YAEA,CADA,cACA,QADA,cACA;AACA;AACA;AACA;AACA;AACA,mCADA;AAEA,4CAFA;AAGA,wBAHA;AAIA;AACA;AACA;AACA;AACA;AACA,SATA;;AAWA,KAzDA;AA0DA,iBA1DA,yBA0DA,QA1DA,EA0DA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+BADA;;;;AAKA,kBALA,CAGA,IAHA,eAGA,IAHA,CAIA,KAJA,eAIA,KAJA;AAMA;;AAEA;AACA;;AAEA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;AACA;;;;;;;;AAQA,OA7BA,EA6BA,KA7BA,CA6BA;AACA;AACA;AACA;AACA;AACA,OAlCA;AAmCA,KApGA;AAqGA,YArGA,sBAqGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAhBA;;;;;AAqBA,6BArBA,CAmBA,OAnBA,yBAmBA,OAnBA,CAoBA,IApBA,yBAoBA,IApBA;AAsBA;AACA,+BADA;;;AAIA;AACA,KAhIA;AAiIA,eAjIA,uBAiIA,EAjIA,EAiIA,MAjIA,EAiIA,QAjIA,EAiIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kBADA;;;AAIA;AACA;AACA;AACA;;AAEA;AACA,0BADA;AAEA,YAFA,GAEA,IAFA,CAEA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA,OATA,EASA,KATA,CASA;AACA;AACA,8BADA;AAEA,2BAFA;;AAIA,OAdA,EAcA,OAdA,CAcA;AACA;AACA,OAhBA;AAiBA,KArKA;AAsKA,cAtKA,sBAsKA,GAtKA,EAsKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAhLA;AAiLA,kBAjLA,0BAiLA,IAjLA,EAiLA,IAjLA,EAiLA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAvLA,EA1JA,E","file":"components/uni-clientdb/uni-clientdb.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uni-clientdb.vue?vue&type=template&id=e6870178&\"\nvar renderjs\nimport script from \"./uni-clientdb.vue?vue&type=script&lang=js&\"\nexport * from \"./uni-clientdb.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/uni-clientdb/uni-clientdb.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=template&id=e6870178&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.1.9.4.20190426.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<slot :options=\"options\" :data=\"dataList\" :pagination=\"paginationInternal\" :loading=\"loading\" :error=\"errorMessage\"></slot>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst db = uniCloud.database();\r\n\tconst dbCmd = db.command;\r\n\r\n\tconst events = {\r\n\t\tload: 'load',\r\n\t\terror: 'error'\r\n\t}\r\n\tconst pageMode = {\r\n\t\tadd: 'add',\r\n\t\treplace: 'replace'\r\n\t}\r\n\r\n\tconst attrs = [\r\n\t\t'pageCurrent',\r\n\t\t'pageSize',\r\n\t\t'collection',\r\n\t\t'action',\r\n\t\t'field',\r\n\t\t'getcount',\r\n\t\t'orderby',\r\n\t\t'where'\r\n\t]\r\n\r\n\t/**\r\n\t * uni-clientdb\r\n\t * @description uni-clientdb是一个数据库查询组件，它是对uni-clientdb的js库的再封装。\r\n\t * @tutorial https://uniapp.dcloud.net.cn/uniCloud/uni-clientdb-component\r\n\t * @property {String} collection 表名\r\n\t * @property {String} action 云端执行数据库查询的前或后，触发某个action函数操作，进行预处理或后处理\r\n\t * @property {String} field 查询字段，多个字段用 `,` 分割\r\n\t * @property {String} orderby 排序字段及正序倒叙设置\r\n\t * @property {String} where 查询条件\r\n\t * @property {String} pageData = [add|replace] `add` 多次查询的集合, `replace` 当前查询的集合\r\n\t * @value add 多次查询的集合\r\n\t * @value replace 当前查询的集合\r\n\t * @property {Number} pageCurrent 当前页\r\n\t * @property {Number} pageSize 每页数据数量\r\n\t * @property {Boolean} getone = [true|false] 指定查询结果是否返回数组第一条数据，默认 false。在false情况下返回的是数组，即便只有一条结果，也需要[0]的方式获取。在true下，直接返回结果数据，少一层数组\r\n\t * @value true 返回数组第一条数据\r\n\t * @value false 返回类型是数组，即便只有一条结果\r\n\t * @property {Boolean} getcount 是否查询总数量\r\n\t * @property {Boolean} manual 是否手动加载数据，默认为 false，页面onready时自动联网加载数据\r\n\t * @value true 开启后需要手动加载数据\r\n\t * @value false 页面onready时自动联网加载数据\r\n\t * @event {Function} load 成功回调。如联网返回结果后，想修改下数据再渲染界面，则在本方法里对data进行修改\r\n\t * @event {Function} error 失败回调\r\n\t */\r\n\texport default {\r\n\t\tname: 'UniClientdb',\r\n\t\tprops: {\r\n\t\t\toptions: {\r\n\t\t\t\ttype: [Object, Array],\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcollection: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\taction: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tfield: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tpageData: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: 'add'\r\n\t\t\t},\r\n\t\t\tpageCurrent: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 1\r\n\t\t\t},\r\n\t\t\tpageSize: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 20\r\n\t\t\t},\r\n\t\t\tgetcount: {\r\n\t\t\t\ttype: [Boolean, String],\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\torderby: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\twhere: {\r\n\t\t\t\ttype: [String, Object],\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tgetone: {\r\n\t\t\t\ttype: [Boolean, String],\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\tmanual: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tloading: false,\r\n\t\t\t\tdataList: this.getone ? {} : [],\r\n\t\t\t\tpaginationInternal: {\r\n\t\t\t\t\tcurrent: this.pageCurrent,\r\n\t\t\t\t\tsize: this.pageSize,\r\n\t\t\t\t\tcount: 0\r\n\t\t\t\t},\r\n\t\t\t\terrorMessage: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis._isEnded = false\r\n\r\n\t\t\tthis.$watch(() => {\r\n\t\t\t\tvar al = []\r\n\t\t\t\tattrs.forEach(key => {\r\n\t\t\t\t\tal.push(this[key])\r\n\t\t\t\t})\r\n\t\t\t\treturn al\r\n\t\t\t}, (newValue, oldValue) => {\r\n\t\t\t\tthis.paginationInternal.pageSize = this.pageSize\r\n\r\n\t\t\t\tlet needReset = false\r\n\t\t\t\tfor (let i = 2; i < newValue.length; i++) {\r\n\t\t\t\t\tif (newValue[i] != oldValue[i]) {\r\n\t\t\t\t\t\tneedReset = true\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (needReset) {\r\n\t\t\t\t\tthis.clear()\r\n\t\t\t\t\tthis.reset()\r\n\t\t\t\t}\r\n\t\t\t\tif (newValue[0] != oldValue[0]) {\r\n\t\t\t\t\tthis.paginationInternal.current = this.pageCurrent\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._execLoadData()\r\n\t\t\t})\r\n\r\n\t\t\t// #ifdef H5\r\n\t\t\tif (process.env.NODE_ENV === 'development') {\r\n\t\t\t\tthis._debugDataList = []\r\n\t\t\t\tif (!window.unidev) {\r\n\t\t\t\t\twindow.unidev = {\r\n\t\t\t\t\t\tclientDB: {\r\n\t\t\t\t\t\t\tdata: []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tunidev.clientDB.data.push(this._debugDataList)\r\n\t\t\t}\r\n\t\t\t// #endif\r\n\r\n\t\t\t// #ifdef MP-TOUTIAO\r\n\t\t\tlet changeName\r\n\t\t\tlet events = this.$scope.dataset.eventOpts\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tlet event = events[i]\r\n\t\t\t\tif (event[0].includes('^load')) {\r\n\t\t\t\t\tchangeName = event[1][0][0]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (changeName) {\r\n\t\t\t\tlet parent = this.$parent\r\n\t\t\t\tlet maxDepth = 16\r\n\t\t\t\tthis._changeDataFunction = null\r\n\t\t\t\twhile (parent && maxDepth > 0) {\r\n\t\t\t\t\tlet fun = parent[changeName]\r\n\t\t\t\t\tif (fun && typeof fun === 'function') {\r\n\t\t\t\t\t\tthis._changeDataFunction = fun\r\n\t\t\t\t\t\tmaxDepth = 0\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent = parent.$parent\r\n\t\t\t\t\tmaxDepth--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// #endif\r\n\r\n\t\t\tif (!this.manual) {\r\n\t\t\t\tthis.loadData()\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #ifdef H5\r\n\t\tbeforeDestroy() {\r\n\t\t\tif (process.env.NODE_ENV === 'development' && window.unidev) {\r\n\t\t\t\tvar cd = this._debugDataList\r\n\t\t\t\tvar dl = unidev.clientDB.data\r\n\t\t\t\tfor (var i = dl.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (dl[i] === cd) {\r\n\t\t\t\t\t\tdl.splice(i, 1)\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #endif\r\n\t\tmethods: {\r\n\t\t\tloadData(args1, args2) {\r\n\t\t\t\tlet callback = null\r\n\t\t\t\tif (typeof args1 === 'object') {\r\n\t\t\t\t\tif (args1.clear) {\r\n\t\t\t\t\t\tthis.clear()\r\n\t\t\t\t\t\tthis.reset()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (args1.current !== undefined) {\r\n\t\t\t\t\t\tthis.paginationInternal.current = args1.current\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof args2 === 'function') {\r\n\t\t\t\t\t\tcallback = args2\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (typeof args1 === 'function') {\r\n\t\t\t\t\tcallback = args1\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._execLoadData(callback)\r\n\t\t\t},\r\n\t\t\tloadMore() {\r\n\t\t\t\tif (this._isEnded) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis._execLoadData()\r\n\t\t\t},\r\n\t\t\trefresh() {\r\n\t\t\t\tthis.clear()\r\n\t\t\t\tthis._execLoadData()\r\n\t\t\t},\r\n\t\t\tclear() {\r\n\t\t\t\tthis._isEnded = false\r\n\t\t\t\tthis.dataList = []\r\n\t\t\t},\r\n\t\t\treset() {\r\n\t\t\t\tthis.paginationInternal.current = 1\r\n\t\t\t},\r\n\t\t\tremove(id, {\r\n\t\t\t\taction,\r\n\t\t\t\tcallback,\r\n\t\t\t\tconfirmTitle,\r\n\t\t\t\tconfirmContent\r\n\t\t\t} = {}) {\r\n\t\t\t\tif (!id || !id.length) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: confirmTitle || '提示',\r\n\t\t\t\t\tcontent: confirmContent || '是否删除该数据',\r\n\t\t\t\t\tshowCancel: true,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._execRemove(id, action, callback)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t_execLoadData(callback) {\r\n\t\t\t\tif (this.loading) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tthis.errorMessage = ''\r\n\r\n\t\t\t\tthis._getExec().then((res) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\tcount\r\n\t\t\t\t\t} = res.result\r\n\t\t\t\t\tthis._isEnded = data.length < this.pageSize\r\n\r\n\t\t\t\t\tcallback && callback(data, this._isEnded)\r\n\t\t\t\t\tthis._dispatchEvent(events.load, data)\r\n\r\n\t\t\t\t\tif (this.getone) {\r\n\t\t\t\t\t\tthis.dataList = data.length ? data[0] : undefined\r\n\t\t\t\t\t} else if (this.pageData === pageMode.add) {\r\n\t\t\t\t\t\tthis.dataList.push(...data)\r\n\t\t\t\t\t\tif (this.dataList.length) {\r\n\t\t\t\t\t\t\tthis.paginationInternal.current++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.pageData === pageMode.replace) {\r\n\t\t\t\t\t\tthis.dataList = data\r\n\t\t\t\t\t\tthis.paginationInternal.count = count\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tif (process.env.NODE_ENV === 'development') {\r\n\t\t\t\t\t\tthis._debugDataList.length = 0\r\n\t\t\t\t\t\tthis._debugDataList.push(...JSON.parse(JSON.stringify(this.dataList)))\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tthis.errorMessage = err\r\n\t\t\t\t\tcallback && callback()\r\n\t\t\t\t\tthis.$emit(events.error, err)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t_getExec() {\r\n\t\t\t\tlet exec = db\r\n\t\t\t\tif (this.action) {\r\n\t\t\t\t\texec = exec.action(this.action)\r\n\t\t\t\t}\r\n\r\n\t\t\t\texec = db.collection(this.collection)\r\n\r\n\t\t\t\tif (!(!this.where || !Object.keys(this.where).length)) {\r\n\t\t\t\t\texec = exec.where(this.where)\r\n\t\t\t\t}\r\n\t\t\t\tif (this.field) {\r\n\t\t\t\t\texec = exec.field(this.field)\r\n\t\t\t\t}\r\n\t\t\t\tif (this.orderby) {\r\n\t\t\t\t\texec = exec.orderBy(this.orderby)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst {\r\n\t\t\t\t\tcurrent,\r\n\t\t\t\t\tsize\r\n\t\t\t\t} = this.paginationInternal\r\n\t\t\t\texec = exec.skip(size * (current - 1)).limit(size).get({\r\n\t\t\t\t\tgetCount: this.getcount\r\n\t\t\t\t})\r\n\r\n\t\t\t\treturn exec\r\n\t\t\t},\r\n\t\t\t_execRemove(id, action, callback) {\r\n\t\t\t\tif (!this.collection || !id) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst ids = Array.isArray(id) ? id : [id]\r\n\t\t\t\tif (!ids.length) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlet exec = db\r\n\t\t\t\tif (action) {\r\n\t\t\t\t\texec = exec.action(action)\r\n\t\t\t\t}\r\n\r\n\t\t\t\texec.collection(this.collection).where({\r\n\t\t\t\t\t_id: dbCmd.in(ids)\r\n\t\t\t\t}).remove().then((res) => {\r\n\t\t\t\t\tcallback && callback(res.result)\r\n\t\t\t\t\tif (this.pageData === pageMode.replace) {\r\n\t\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.removeData(ids)\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}).finally(() => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tremoveData(ids) {\r\n\t\t\t\tlet il = ids.slice(0)\r\n\t\t\t\tlet dl = this.dataList\r\n\t\t\t\tfor (let i = dl.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tlet index = il.indexOf(dl[i]._id)\r\n\t\t\t\t\tif (index >= 0) {\r\n\t\t\t\t\t\tdl.splice(i, 1)\r\n\t\t\t\t\t\til.splice(index, 1)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t_dispatchEvent(type, data) {\r\n\t\t\t\tif (this._changeDataFunction) {\r\n\t\t\t\t\tthis._changeDataFunction(data, this._isEnded)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$emit(type, data, this._isEnded)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\n"],"sourceRoot":""}